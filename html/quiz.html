<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Importação da bliblioteca de estilização CSS Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../style/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
</head>

<body>
    <!-- navbar do site -->
    <nav id="navBar" class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
        <a class="navbar-brand" href="#navBar">RayNiel's Machine</a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="conversor.html">Conversor</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="calculadora.html">Calculadora</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="quiz.html">Quiz <i class="sr-only">(atual)</i></a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- criar uma div pai-->
    <div class="container-lg">
        <!-- div do conteúdo do conversor -->
        <div class="container">
            <center id="conteudo">
                <!-- titulo -->
                <h1>Quiz de Sistemas Numéricos</h1>
                <br><br>

                <!-- descrição -->
                <h4>Esse Quiz se trata sobre X perguntas sobre conversão de diferentes bases e diversos cálculos (adição, subtração, divisão e multiplicação).</h4>
                <br><br>
                
                <!-- Botão Inicar o Quiz, setando para a função a primeira pergunta por default (valor 0)-->
                <button class="btn btn-success btn-lg" onclick="carregarPergunta(0)">Iniciar Quiz</button>
                <br>
            </center>
        </div>
    </div>
</body>

</html>

<script>
    fetch('https://server.com/data.json')
    .then((response) => response.json())
    .then((json) => console.log(json));
    // Mensagem padrão do Menu inicial
    const conteudoMenuInicial = `
        <!-- titulo -->
        <h1>Quiz de Sistemas Numéricos</h1>
        <br><br>

        <!-- descrição -->
        <h4>Esse Quiz se trata sobre 5 perguntas sobre conversão de diferentes bases e diversos cálculos (adição, subtração, divisão e multiplicação).</h4>
        <br><br>
            
        <!-- Botão Inicar o Quiz -->
        <button class="btn btn-success btn-lg" onclick="carregarPergunta(0)">Iniciar Quiz</button>
        <br>
    `;
    // variveis para controlarmos as questoes
    var indexPerguntasAcertadas = [];
    var numeroPerguntaAtual = 0;

    // as informações sobre as questões
    let perguntas = [
        {
            enunciado:'O número 345₁₀ , convertido para a base 16, dá qual resultado?  ',
            opcoes:['153₁₆','155₁₆','157₁₆','159₁₆'],
            resposta: '159₁₆',
        },
        {
            enunciado:'Qual o valor do número 0110110110110011₂ em Decimal?',
            opcoes:['28083₁₀','28073₁₀','27083₁₀','27073₁₀'],
            resposta: '28083₁₀',
        },
        {
            enunciado:'Resolva este cálculo: (123F₁₆) + (14563₈)',
            opcoes:['25662₈','2BB4₁₆','11186₁₀','10101110111010₂'],
            resposta: '11186₁₀',
        },
        {
            enunciado:'Resolva este cálculo: [(F55₁₆)-(383₁₀)]-[(14563₁₀)+(777₈)]',
            opcoes:['10520₁₀','290E₁₆','10100100001110₂','24416₈'],
            resposta: '24416₈',
        },
        {
            enunciado:'Resolva este cálculo: [(A₁₆)+(7₈)]**[(100₁₀)/(24₈)]',
            opcoes:['101011010101001011001₂','101011010101101010001₂','101011010101001010001₂','101011010101001010011₂'],
            resposta: '101011010101001010001₂',
        },
    ];

    // aqui vamos guardar todas as respostas do user
    var respostas = [
        {
            resposta:'',
        },
        {
            resposta:'',
        },
        {
            resposta:'',
        },
        {
            resposta:'',
        },
        {
            resposta:'',
        },
    ];

    function carregarPergunta(numPergunta){
        // o numero da pergunta atual é o que foi atribuido a esta função
        numeroPerguntaAtual = numPergunta;

        // Informar ao user qual questão está
        conteudo.innerHTML = `
            <h1 id="titulo">${numeroPerguntaAtual+1}ª Pergunta</h1>
            <br>
            <h4 id="enunciado">${perguntas[numeroPerguntaAtual].enunciado}</h4>
            <br>
        `;

        // fazer um loop para listar todas as opções das perguntas
        for (let opcao of perguntas[numeroPerguntaAtual].opcoes){
            if (opcao == respostas[numeroPerguntaAtual].resposta){ // caso a opção seja alguma em que o usuario tenha sleecionado anteriormente
                // Vai aparecer como checkado
                conteudo.innerHTML += `
                    <input checked onchange="salvarResposta(${numeroPerguntaAtual},${opcao})" type="radio" id="opt${opcao}" name="resposta" value="${opcao}">
                    <label for="${opcao}">${opcao}</label><br>
                `;
            } else {
                // Só aparece a opção sem estar checkado
                conteudo.innerHTML += `
                    <input onchange="salvarResposta(${numeroPerguntaAtual},'${opcao}')" type="radio" id="opt${opcao}" name="resposta" value="${opcao}">
                    <label for="${opcao}">${opcao}</label><br>
                `;
            }
        }

        // parte das mudanças de páginas e ações do user
        if(numeroPerguntaAtual == (perguntas.length - 1)){ // Caso seja a ultima pergunta da lista de perguntas
            // vai mostrar o botoes Voltar e Finalizar Quiz, por ele estar na última pergunta, não precisa avançar mais questão
            conteudo.innerHTML += `
                    <br><br>
            
                    <button class="btn btn-success btn-lg" onclick="voltarPergunta()">Voltar Pergunta</button>
                    <br>
 
                    <button class="btn btn-success btn-lg" onclick="finalizarQuiz()">Finalizar Quiz</button>
                    <br>
                </center>
            `;
        } else if(numeroPerguntaAtual == 0){ // caso esteja na primeira questão
            // vai mostrar apenas o botão para a proxima pergunta, pois é a primeira
            conteudo.innerHTML += `
                    <br><br>
                    <button class="btn btn-success btn-lg" onclick="proxPergunta()">Próxima Pergunta</button>
                    <br>
                </center>
            `;
        } else { // caso não seja uma questão de extremos
            // vai mostrar o btn de prox e voltar pergunta
            conteudo.innerHTML += `
                    <br><br>
                    <button class="btn btn-success btn-lg" onclick="voltarPergunta()">Voltar Pergunta</button>
                    <br>
 
                    <button class="btn btn-success btn-lg" onclick="proxPergunta()">Próxima Pergunta</button>
                    <br>
                </center>
            `;
        }
        
    }

    function salvarResposta(numPergunta, resposta){
        // settar as respostas escolhidas pelo user de acordo com base nas escolhas
        respostas[numPergunta].resposta = resposta;
    }

    function proxPergunta(){
        // add 1 ao valor da pergunta
        numeroPerguntaAtual++;
        // recarregar a página com os dados da nova pergunta
        carregarPergunta(numeroPerguntaAtual);
    }

    function voltarPergunta(){
        // retira 1 ao valor da pergunta
        numeroPerguntaAtual--;
        // recarregar a página com os dados da nova pergunta
        carregarPergunta(numeroPerguntaAtual);
    }

    function finalizarQuiz(){
        // Ao terminar o quiz, irá fechar todas as respostas
        for (let i = 0; i < perguntas.length; i++) {
            // caso a resposta da pergunta seja igual ao q o usuário informou 
            if(perguntas[i].resposta == respostas[i].resposta){
                // vai add o número da pergunta que foi feita a lista de questoes q o user acertou
                indexPerguntasAcertadas.push(i+1);
            }
        }
        // Titulo Padrão da mensagem final
        conteudo.innerHTML = `
            <h1>Resultado!</h1>
            <br><br>
        `;

        if (indexPerguntasAcertadas.length == 0){ // caso o tamanho do array da lista dos acertos do user seja 0 (ou seja, errou tudo)
            // mostrar msg 
            conteudo.innerHTML += `
                <h4>Olha, estude mais e volte aqui mais preparado, pois você zerou a prova.</h4>
                <br><br>
            `;
        } else if (indexPerguntasAcertadas.length <= 2){ // caso o tamanho do array da lista dos acertos do user seja >0 e <=2 (acertou 1 ou 2 questões)
            // mostrar msg informando quantas acertou e quais acertou
            conteudo.innerHTML += `
                <h4>Você acertou ${indexPerguntasAcertadas.length}, sendo elas as questões ${indexPerguntasAcertadas}. Não foi tão bem, mas dá pra melhorar!</h4>
                <br><br>
            `;
        } else if (indexPerguntasAcertadas.length <= 4){
            // mostrar msg informando quantas acertou e quais acertou
            conteudo.innerHTML += `
                <h4>Você acertou ${indexPerguntasAcertadas.length}, sendo elas as questões ${indexPerguntasAcertadas}. Já acertou mais da metade. PARABÉNS!</h4>
                <br><br>
            `;
        } else {
            // mostrar msg informando do gabarito
            conteudo.innerHTML += `
                <h4>Boa! Acertou TODAS. Você é o orgulho da Marise. <b>IT'S OVER!</b></h4>
                <br><br>
            `;
        }
    
        // Botão para voltar ao menu iniciar
        conteudo.innerHTML += `
            <button class="btn btn-success btn-lg" onclick="resetarQuiz()">Voltar ao Menu</button>
            <br>
        `;

    }

    function embaralharListas(perguntas) {
        // criar uma nova lista
        const novaListaPerguntas = [];
        // sortear um número aleatório de acordo com o número máximo do original
        var numero = Math.floor(Math.random() * perguntas.length);
        // contador para limitar quando o mebaralhamento acabar
        var contador = 1;
        // adcionar o conteúdo de um determinado index no primeiro index do novo array
        novaListaPerguntas.push(perguntas[numero]);

        // quando o contador se tornar igual o tamanho do array original, ele irá parar o loop
        while (contador < perguntas.length) {
            // gerar outro numero aleatorio
            numero = Math.floor(Math.random() * perguntas.length);
            // caso não exista o valor com o número de index que foi sorteado
            if (!novaListaPerguntas.includes(perguntas[numero])) {
                // adicionará 1 ao contador
                contador++;
                // irá adicionar o valor desse determinado index ao novo array
                novaListaPerguntas.push(perguntas[numero]);
            }
        }
        // caso já tenha inserido todos os valores na nova array, irá devolver o valor dela
        return novaListaPerguntas;
    }

    function resetarQuiz(){
        for (let i = 0; i < perguntas.length; i++) {
            // resetar as respostas
            respostas[i].resposta = '';
            // embaralhar cada lista de opções de cada resposta
            perguntas[i].opcoes = embaralharListas(perguntas[i].opcoes);
        }

        // resetar as variáveis de controlar as questões
        var indexPerguntasAcertadas = [];
        var numeroPerguntaAtual = 0;

        // resetando o conteúdo para ficar como o Menu Inicial novamente
        conteudo.innerHTML = conteudoMenuInicial;
        // embaralhar as perguntas
        perguntas = embaralharListas(perguntas);
    }
</script>